name: Build and Push Xfce4 Container

on:
  push:
    branches:
      - main
    paths:
      - 'xfce4/**'
      - '.github/workflows/build-xfce4.yaml'

jobs:
  build-and-push:
    runs-on: ubuntu-latest

    steps:
      # Install qemu
      - name: Install qemu dependency
        run: |
          sudo apt-get update
          sudo apt-get install -y qemu-user-static

      # Login into ghcr.io
      - name: Log in to ghcr.io
        uses: redhat-actions/podman-login@v1
        with:
          username: '${{ github.actor }}'
          password: '${{ github.token }}'
          registry: 'ghcr.io/${{ github.repository_owner }}'

      # Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # Run the build script
      - name: Build and push container
        run: |
          ./build.sh -p --push --platform linux/amd64,linux/arm64/v8 xfce4